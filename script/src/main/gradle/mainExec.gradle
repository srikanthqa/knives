import groovy.lang.Closure
import org.codehaus.groovy.tools.GroovyClass
import org.gradle.api.Project
import org.gradle.api.Rule
import org.gradle.api.tasks.wrapper.Wrapper


def description = 'Pattern: "mainExec <Main-Class> [args]": Executes the main class with class as configurations.compile and built jar'
tasks.addRule(description) { final String taskName ->
	final String[] tokens = taskName.split(" ")
	final String prefix = "mainExec"
	if (tokens[0].equals(prefix) && !tasks.findByName(taskName) && tokens.length >= 2) {
		Task mainExec = task(taskName, type: JavaExec) {
			classpath = configurations.compile + tasks.jar.outputs.files
			main = tokens[1]
			args = tokens.length > 2 ? tokens[2..-1] : []
		}
		
		mainExec.dependsOn jar
	}
}
