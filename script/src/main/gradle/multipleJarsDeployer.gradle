apply plugin: 'maven'
apply plugin: 'signing'

configurations { 
	//declaring new configuration that will be used to associate with artifacts
	schema 
}

artifacts {
	schema jar
}

signing {
	sign configurations.schema
}

uploadArchives {
    repositories {
        mavenDeployer {
            beforeDeployment { MavenDeployment deployment -> signing.signPom(deployment) }
 
            repository(url: "https://oss.sonatype.org/service/local/staging/deploy/maven2/") {
	            authentication(userName: sonatypeUsername, password: sonatypePassword)
            }
 
            pom.project {
               name 'GradleFx'
               packaging 'jar'
               description 'GradleFx is a Gradle plugin for building Flex and Actionscript applications'
               url 'http://gradlefx.github.com/'
 
               scm {
                   url 'scm:git@github.com:GradleFx/GradleFx.git'
                   connection 'scm:git@github.com:GradleFx/GradleFx.git'
                   developerConnection 'scm:git@github.com:GradleFx/GradleFx.git'
               }
 
               licenses {
                   license {
                       name 'The Apache Software License, Version 2.0'
                       url 'http://www.apache.org/licenses/LICENSE-2.0.txt'
                       distribution 'repo'
                   }
               }
 
               developers {
                   developer {
                       id 'khaing211'
                       name 'Khai Nguyen'
                   }
               }
           }
	
           // creates filters for each jar produced by appMap entries (if any)
           appMap.each { String key, Map value ->
			   def jarName = "bb4-$key"
			   def jarPom = addFilter("${key}Jar") { artifact, file ->
			       artifact.name == jarName
			   }
			   jarPom.project jarPomConfig
			   jarPom.artifactId = jarName
			   jarPom.name = jarName
			   def ascPom = addFilter("${key}Jar.asc") { artifact, file ->
			       artifact.name == "bb4-${key}-${version}.jar.asc"
			   }
			   ascPom.project jarPomConfig
			   ascPom.artifactId = jarName
			   ascPom.name = 'asc-' + jarName
			   def ascJavadocPom = addFilter("${key}JavadocJar.asc") { artifact, file ->
			       artifact.name == "bb4-${key}-${version}-javadoc.jar.asc"
			   }
			   ascJavadocPom.project jarPomConfig
			   ascJavadocPom.artifactId = jarName
			   ascJavadocPom.name = 'javadoc-' + jarName
			   def ascSourcesPom = addFilter("${key}SourcesJar.asc") { artifact, file ->
			       artifact.name == "bb4-${key}-${version}-sources.jar.asc"
			   }
			   ascSourcesPom.project jarPomConfig
			   ascSourcesPom.artifactId = jarName
			   ascSourcesPom.name = 'sources-' + jarName
			}	
        }
    }
}